import{G as A,f as u,r as h,v as T,u as q,e as p,h as B,w as v,j as t,L as P,x as L,z as k,d as K,y as z,A as G,D as Q,E as O,B as f}from"./index-DClgmVCF.js";import{S as R}from"./SliderNext-CoGZHuFk.js";import"./index-Cwmpj2TY.js";function _(r){return A({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"6 9 12 15 18 9"},child:[]}]})(r)}const D=async()=>{const r=u.get("accessToken"),s=await fetch(`${f}/admin/category?page=1`,{method:"GET",headers:{Accept:"*/*",Authorization:`Bearer ${r}`}});if(!s.ok)throw new Error("خطا در دریافت داده‌ها");return(await s.json()).categories},H=async r=>{const s=u.get("accessToken"),n=await fetch(`${f}/client/subCategories/category/${r}`,{method:"GET",headers:{Accept:"*/*",Authorization:`Bearer ${s}`}});if(!n.ok)throw new Error("خطا در دریافت زیرشاخه‌ها");return(await n.json()).subCategories||[]},M=async r=>{const s=u.get("accessToken"),n=await fetch(`${f}/client/products/${r}?page=1`,{method:"GET",headers:{Accept:"*/*",Authorization:`Bearer ${s}`}});if(!n.ok)throw new Error("خطا در دریافت محصولات");return(await n.json()).products},J=async()=>{const r=u.get("accessToken");return(await fetch(`${f}/client/likes`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},method:"GET"})).json()},X=()=>{const r=u.get("accessToken"),[s,n]=h.useState(5),[o,g]=h.useState(""),l=T(),w=q(),{data:j,isLoading:N}=p({queryKey:["main category"],queryFn:D}),{data:i}=p({queryKey:["subcategory",s],queryFn:()=>H(s),enabled:!!s}),{data:c,isLoading:C}=p({queryKey:["products",o],queryFn:()=>M(o),enabled:!!o});h.useEffect(()=>{s&&(g(""),l.invalidateQueries({queryKey:["subcategory",s]}))},[s,l]),h.useEffect(()=>{var e;i&&i.length>0&&g((e=i[0])==null?void 0:e.id.toString())},[i]),h.useEffect(()=>{o&&l.invalidateQueries({queryKey:["products",o]})},[o,l]);const d=B(e=>e.cardReducer.products),F=e=>(d==null?void 0:d.some(a=>a.id===e))??!1,S=p({queryKey:["likes"],queryFn:J}),b=v({mutationFn:e=>fetch(`http://localhost:3000/api/v1/client/likes/${e}`,{headers:{authorization:`Bearer ${r}`},method:"POST"}).then(a=>a.json()),onSuccess:()=>{l.invalidateQueries({queryKey:["likes"]})}}),E=v({mutationFn:([e,a])=>fetch("http://localhost:3000/api/v1/client/stars",{headers:{"content-Type":"application/json",authorization:`Bearer ${r}`},method:"POST",body:JSON.stringify({product_id:e,star:a})}).then(m=>m.json()).then(m=>console.log(m)),onSuccess:()=>{l.invalidateQueries({queryKey:["products"]})}});if(N||C)return t.jsx("div",{className:"flex h-screen items-center justify-center",children:t.jsx("div",{className:"h-16 w-16 animate-spin rounded-full border-t-4 border-b-4 border-[#417F56]"})});const y=j==null?void 0:j.slice(0,4),$=e=>{c==null||c.map(a=>a.id===e?{...a,isFavorite:!a.isFavorite}:a)};return t.jsxs(t.Fragment,{children:[t.jsx(R,{}),t.jsxs("div",{className:"container mx-auto px-5",children:[t.jsx("div",{className:"mt-5 flex flex-wrap items-center justify-end gap-4 rounded-2xl bg-[#F8F8F8] p-7 shadow-md sm:flex-row sm:gap-8",children:y==null?void 0:y.map(e=>t.jsx("div",{className:`cursor-pointer text-lg font-medium text-[#5A5A5A] transition-all duration-300 ease-in-out hover:scale-110 hover:font-bold hover:text-[#417F56] ${e.id===s?"scale-110 border-b-2 border-[#417F56] font-bold text-[#417F56]":""}`,onClick:()=>n(e.id),children:t.jsx("h3",{children:e.title})},e.id))}),t.jsxs("div",{className:"mx-auto mt-6 flex w-full max-w-3xl flex-col items-center gap-4 sm:flex-row sm:gap-6",children:[t.jsx("form",{className:"flex-1",children:t.jsx("input",{className:"h-12 w-full rounded-full bg-[#ECECEC] px-5 text-black transition-all duration-300 outline-none focus:bg-white focus:ring-2 focus:ring-[#417F56]",type:"text",placeholder:"جستجو..."})}),t.jsxs("div",{className:"relative w-full sm:w-52",children:[t.jsx("select",{value:o||"",onChange:e=>g(e.target.value),className:"h-12 w-full cursor-pointer appearance-none rounded-full bg-[#417F56] px-6 pr-10 text-white shadow-md transition-all duration-300 outline-none hover:bg-[#355E44] hover:shadow-lg focus:ring-2 focus:ring-[#2E5E3A] sm:w-50",children:i&&Array.isArray(i)&&i.map(e=>t.jsx("option",{value:e.id,children:e.title},e.id))}),t.jsx(_,{className:"absolute top-1/2 right-5 -translate-y-1/2 text-xl text-white transition-transform duration-300 ease-in-out"})]})]}),t.jsx("div",{className:"mt-10 flex items-center justify-between",children:t.jsxs("button",{className:"flex h-10 w-44 cursor-pointer items-center justify-center gap-3 rounded-2xl border border-[#417F56] bg-white p-2 text-[#417F56] shadow-md transition-all duration-300 ease-in-out hover:scale-105 hover:bg-[#417F56] hover:text-white",children:[t.jsxs(P,{to:"/cart",className:"text-base font-medium",children:[(d==null?void 0:d.length)||0," تکمیل خرید"]}),t.jsx(L,{className:"h-6 w-6"})]})}),t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"text-2xl font-semibold",children:"محصولات"}),t.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2",children:c==null?void 0:c.map(e=>{var a;return t.jsxs("div",{className:"flex flex-col items-center justify-between rounded-lg bg-white p-4 shadow-md transition-all duration-300 hover:scale-105 sm:flex-row sm:gap-6",style:{minHeight:"158px"},children:[t.jsx("img",{src:`http://localhost:3000/${e.image_url}`,alt:"",className:"h-[158px] w-[230px] rounded-md object-cover transition-transform duration-300 hover:scale-105 sm:block md:hidden"}),t.jsxs("div",{className:"mt-4 flex w-full flex-col sm:mr-4 sm:w-2/3 sm:pl-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"cursor-pointer transition-transform duration-300 hover:scale-125",onClick:()=>$(e.id),children:S.data.some(m=>m.product.id==e.id)?t.jsx(k,{onClick:()=>b.mutate(e.id),className:"h-[24px] w-[24px] text-red-500 transition-all duration-300"}):t.jsx(k,{onClick:()=>b.mutate(e.id),className:"h-[24px] w-[24px] text-gray-500 transition-all duration-300"})}),t.jsx("h4",{className:"text-[16px] font-semibold sm:text-[20px]",children:e.name})]}),t.jsxs("div",{className:"mt-5 flex items-center justify-between",children:[t.jsxs("p",{className:"text-[14px] text-[#353535] sm:text-[18px]",children:[t.jsxs("span",{children:[e.coupon?+e.price*e.coupon.percent-+e.price:e.price," "]}),t.jsx("span",{children:"تومان"})]}),t.jsx("p",{className:"text-[12px] text-[#353535] sm:text-[14px]",children:e.description})]}),e.coupon&&t.jsxs("div",{className:"mt-2 flex w-fit text-red-800",children:[(a=e.coupon)==null?void 0:a.percent,"%"]}),t.jsxs("div",{className:"mt-5 mb-6 flex items-center justify-center gap-1",children:[t.jsx("button",{onClick:()=>{w(K(e)),z.success("✅ محصول با موفقیت به سبد خرید اضافه شد!",{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"})},className:"flex h-[40px] w-[100%] cursor-pointer items-center justify-center rounded-md bg-[#417F56] font-semibold text-white disabled:bg-white disabled:text-gray-500 sm:w-[244px]",children:"افزودن به سبد خرید"}),F(e.id)&&t.jsx("button",{onClick:()=>w(Q(e)),className:"mt-2 rounded-2xl border-1 border-stone-400 p-2 sm:mt-0",children:t.jsx(G,{})}),[...Array(5)].map((m,x)=>t.jsx(O,{className:`h-[20px] w-[20px] cursor-pointer transition-all duration-300 sm:h-[24px] sm:w-[24px] ${x<e.TotalStars?"text-yellow-400":"text-gray-300"}`,onClick:()=>{console.log(typeof e.id,typeof x),E.mutate([+e.id,+(x+1)])}},x))]})]}),t.jsx("img",{src:`http://localhost:3000/${e.image_url}`,alt:"",className:"hidden h-[158px] w-[230px] rounded-md object-cover transition-transform duration-300 hover:scale-105 md:block"})]},e.id)})})]})]})]})};export{X as default};
