import{a4 as E,u as $,j as e,a5 as v,h as A,y as T,a6 as q,a7 as P,a8 as B,a9 as L,e as j,r as u,aa as K,i as y,o as z,f as N,L as Q,g as G,B as h}from"./index-B-yqNhxt.js";import{b as O}from"./SliderNext-DBa-dpXv.js";import"./proxy-DkOErG3r.js";function _(r){return E({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"6 9 12 15 18 9"},child:[]}]})(r)}const R=()=>e.jsxs("div",{className:"flex animate-pulse flex-col items-center justify-between rounded-lg bg-gray-100 p-4 shadow-md sm:flex-row sm:gap-6",children:[e.jsx("div",{className:"h-[158px] w-[230px] rounded-md bg-gray-200"}),e.jsxs("div",{className:"mt-4 flex w-full flex-col sm:mr-4 sm:w-2/3 sm:pl-4",children:[e.jsx("div",{className:"mb-2 h-6 w-1/3 rounded-md bg-gray-200"}),e.jsx("div",{className:"mb-4 h-4 w-1/2 rounded-md bg-gray-200"}),e.jsx("div",{className:"h-4 w-full rounded-md bg-gray-200"}),e.jsx("div",{className:"mt-6 h-10 w-full rounded-md bg-gray-200"})]}),e.jsx("div",{className:"hidden h-[158px] w-[230px] rounded-md bg-gray-200 md:block"})]}),H=({toggleFavorite:r,likeProduct:n,setRate:a,isProductInCart:m,likes:o,products:i,productsLoading:l,isLoading:g})=>{const w=$();return g||l?e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"mb-4 text-2xl font-semibold",children:"محصولات"}),e.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2",children:[...Array(6)].map((s,c)=>e.jsx(R,{},c))})]}):(console.log(i),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"mb-4 text-2xl font-semibold",children:"محصولات"}),e.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2",children:i==null?void 0:i.map(s=>{var c;return e.jsxs("div",{className:"flex flex-col items-center justify-between rounded-lg bg-white p-4 shadow-md transition-all duration-300 hover:scale-105 sm:flex-row sm:gap-6",style:{minHeight:"158px"},children:[e.jsx("img",{src:s.image_url,alt:"",className:"h-[158px] w-[230px] rounded-md object-cover transition-transform duration-300 hover:scale-105 sm:block md:hidden"}),e.jsxs("div",{className:"mt-4 flex w-full flex-col sm:mr-4 sm:w-2/3 sm:pl-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{onClick:()=>r(s.id),children:Array.isArray(o.data)&&o.data.some(p=>p.product.id===s.id)?e.jsx(v,{onClick:()=>n.mutate(s.id),className:"h-[24px] w-[24px] text-red-500 transition-all duration-300"}):e.jsx(v,{onClick:()=>n.mutate(s.id),className:"h-[24px] w-[24px] text-gray-500 transition-all duration-300"})}),e.jsx("h4",{className:"text-[16px] font-semibold sm:text-[20px]",children:s.name})]}),e.jsxs("div",{className:"mt-5 flex relative items-center  justify-between",children:[e.jsxs("p",{className:"text-[14px]  text-[#353535] sm:text-[18px]",children:[e.jsx("span",{className:"flex flex-row-reverse",children:s.coupon?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"border p-1 rounded-md text-zinc-400 line-through",children:s.price}),e.jsx("span",{children:+s.price-+s.price*s.coupon.percent/100})]}):s.price}),e.jsx("span",{children:"تومان"})]}),e.jsx("p",{className:"text-[12px] text-[#353535] sm:text-[14px]",children:s.description}),s.coupon&&e.jsx("div",{className:"mt-2 flex w-fit absolute rounded-full -top-5 -left-3 p-1 text-[12px] bg-red-700 text-white -rotate-45",children:(c=s.coupon)==null?void 0:c.percent})]}),e.jsxs("div",{className:"mt-8 mb-3 flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>{w(A(s)),T.success("✅ محصول با موفقیت به سبد خرید اضافه شد!",{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})},className:"flex h-[40px] w-[100%] cursor-pointer items-center justify-center rounded-md bg-[#417F56] font-semibold text-white disabled:bg-white disabled:text-gray-500 sm:w-[244px]",children:"افزودن به سبد خرید"}),m(s.id)&&e.jsx("button",{onClick:()=>w(P(s)),className:"mt-2 rounded-2xl border border-stone-400 p-2 sm:mt-0",children:e.jsx(q,{})}),[...Array(5)].map((p,d)=>e.jsx(B,{className:`w-[25px] cursor-pointer transition-all duration-300 sm:h-[24px] sm:w-[24px] ${d<s.TotalStars?"text-yellow-400":"text-gray-500"}`,onClick:()=>a.mutate([+s.id,+(d+1)])},d))]})]}),e.jsx("img",{src:`${s.image_url}`,alt:"",className:"hidden h-[158px] w-[230px] rounded-md object-cover transition-transform duration-300 hover:scale-105 md:block"})]},s.id)})})]}))},M=async()=>{const r=j.get("accessToken"),n=await fetch(`${h}/client/category?page=1`,{method:"GET",headers:{Accept:"*/*",Authorization:`Bearer ${r}`}});if(!n.ok)throw new Error("خطا در دریافت داده‌ها");return(await n.json()).categories},D=async r=>{const n=j.get("accessToken"),a=await fetch(`${h}/client/subCategories/category/${r}`,{method:"GET",headers:{Accept:"*/*",Authorization:`Bearer ${n}`}});if(!a.ok)throw new Error("خطا در دریافت زیرشاخه‌ها");return(await a.json()).subCategories||[]},J=async r=>{const n=j.get("accessToken"),a=await fetch(`${h}/client/products/${r}?page=1`,{method:"GET",headers:{Accept:"*/*",Authorization:`Bearer ${n}`}});if(!a.ok)throw new Error("خطا در دریافت محصولات");return(await a.json()).products},U=async()=>{const r=j.get("accessToken");return{data:await(await fetch(`${h}/client/likes`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},method:"GET"})).json()}},Y=()=>{const r=L().category||"1",n=j.get("accessToken"),[a,m]=u.useState(Number(r)),[o,i]=u.useState(""),l=K(),{data:g,isLoading:w}=y({queryKey:["main category"],queryFn:M}),{data:s}=y({queryKey:["subcategory",a],queryFn:()=>D(a),enabled:!!a}),{data:c,isLoading:p}=y({queryKey:["products",o],queryFn:()=>J(o),enabled:!!o}),{data:d}=y({queryKey:["likes"],queryFn:U});u.useEffect(()=>{a&&(i(""),l.invalidateQueries({queryKey:["subcategory",a]}))},[a,l]),u.useEffect(()=>{s&&s.length>0&&i(s[0].id.toString())},[s]),u.useEffect(()=>{o&&l.invalidateQueries({queryKey:["products",o]})},[o,l]),u.useEffect(()=>{m(Number(r))},[r]);const x=z(t=>t.cardReducer.products),k=t=>(x==null?void 0:x.some(f=>f.id===t))??!1,b=N({mutationFn:t=>fetch(`${h}/client/likes/${t}`,{headers:{authorization:`Bearer ${n}`},method:"POST"}).then(f=>f.json()),onSuccess:()=>{l.invalidateQueries({queryKey:["likes"]})}}),C=N({mutationFn:([t,f])=>fetch(`${h}/client/stars`,{headers:{"content-Type":"application/json",authorization:`Bearer ${n}`},method:"POST",body:JSON.stringify({product_id:t,star:f})}).then(S=>S.json()),onSuccess:()=>{l.invalidateQueries({queryKey:["products"]})}}),F=t=>{b.mutate(t)};return console.log(c),e.jsxs(e.Fragment,{children:[e.jsx(O,{}),e.jsxs("div",{className:"container mx-auto px-5",children:[e.jsx("div",{className:"mt-5 flex flex-wrap items-center justify-end gap-3 rounded-2xl bg-[#F8F8F8] p-4 shadow-md sm:flex-row sm:gap-8 sm:p-7",children:g==null?void 0:g.map(t=>e.jsx("div",{className:`cursor-pointer text-lg font-medium text-[#5A5A5A] transition-all duration-300 ease-in-out hover:scale-110 hover:font-bold hover:text-[#417F56] ${t.id===a?"scale-110 border-b-2 border-[#417F56] font-semibold text-[#417F56]":""}`,onClick:()=>m(t.id),children:e.jsx("h3",{children:t.title})},t.id))}),e.jsxs("div",{className:"mx-auto mt-6 flex w-full max-w-3xl flex-col items-center gap-4 sm:flex-row sm:gap-6",children:[e.jsx("form",{className:"flex-1",children:e.jsx("input",{className:"h-12 w-full rounded-full bg-[#ECECEC] px-5 text-black transition-all duration-300 outline-none focus:bg-white focus:ring-2 focus:ring-[#417F56]",type:"text",placeholder:"جستجو..."})}),e.jsxs("div",{className:"relative w-full sm:w-52",children:[e.jsx("select",{value:o||"",onChange:t=>i(t.target.value),className:"h-12 w-full cursor-pointer appearance-none rounded-full bg-[#417F56] px-6 pr-10 text-white shadow-md transition-all duration-300 outline-none hover:bg-[#355E44] hover:shadow-lg focus:ring-2 focus:ring-[#2E5E3A] sm:w-50",children:s==null?void 0:s.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))}),e.jsx(_,{className:"absolute top-1/2 right-5 -translate-y-1/2 text-xl text-white transition-transform duration-300 ease-in-out"})]})]}),e.jsx("div",{className:"mt-10 flex items-center justify-between",children:e.jsxs("button",{className:"flex h-10 w-44 cursor-pointer items-center justify-center gap-3 rounded-2xl border border-[#417F56] bg-white p-2 text-[#417F56] shadow-md transition-all duration-300 ease-in-out hover:scale-105 hover:bg-[#417F56] hover:text-white",children:[e.jsxs(Q,{to:"/cart",className:"text-base font-medium",children:[(x==null?void 0:x.length)||0," تکمیل خرید"]}),e.jsx(G,{className:"h-6 w-6"})]})}),e.jsx(H,{toggleFavorite:F,likeProduct:b,setRate:C,isProductInCart:k,likes:{data:(d==null?void 0:d.data)||[]},products:c??[],isLoading:w||p,productsLoading:p})]})]})};export{Y as default};
